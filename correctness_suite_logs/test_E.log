TEST: E (OR across tables)
QUERY:
SELECT COUNT(*) FROM orders;

ENABLED POLICIES:
orders : orders.o_custkey = customer.c_custkey AND customer.c_nationkey = nation.n_nationkey AND nation.n_regionkey = region.r_regionkey AND lineitem.l_orderkey = orders.o_orderkey AND ((region.r_name IN ('EUROPE','ASIA') AND orders.o_orderstatus IN ('O','F')) OR (lineitem.l_shipmode IN ('MAIL','SHIP') AND orders.o_orderpriority IN ('1-URGENT','2-HIGH')))

EXPLAIN OFF (custom_filter.enabled=off):
Aggregate
  ->  Index Only Scan using cf_rls_k11_orders_o_orderstatus_20 on orders

EXPLAIN ON (custom_filter.enabled=on):
ERROR: ERROR:  custom_filter[memctx_violation]: allocation escaped query context (label=artifact_blob rel=<global>)
--- ON notices ---
NOTICE:  policy_eval: target=orders tokens=IDENT:orders.o_custkey OP:= IDENT:customer.c_custkey AND:and IDENT:customer.c_nationkey OP:= IDENT:nation.n_nationkey AND:and IDENT:nation.n_regionkey OP:= IDENT:region.r_regionkey AND:and IDENT:lineitem.l_orderkey OP:= IDENT:orders.o_orderkey AND:and LPAREN:( LPAREN:( IDENT:region.r_name OP:in LPAREN:( STRING:'EUROPE' COMMA:, STRING:'ASIA' RPAREN:) AND:and IDENT:orders.o_orderstatus OP:in LPAREN:( STRING:'O' COMMA:, STRING:'F' RPAREN:) RPAREN:) OR:or LPAREN:( IDENT:lineitem.l_shipmode OP:in LPAREN:( STRING:'MAIL' COMMA:, STRING:'SHIP' RPAREN:) AND:and IDENT:orders.o_orderpriority OP:in LPAREN:( STRING:'1-URGENT' COMMA:, STRING:'2-HIGH' RPAREN:) RPAREN:) RPAREN:)
NOTICE:  policy_eval: target=orders join_classes=[0, 1, 2, 3]
NOTICE:  policy_eval: policy[1] target=orders expr=orders.o_custkey = customer.c_custkey AND customer.c_nationkey = nation.n_nationkey AND nation.n_regionkey = region.r_regionkey AND lineitem.l_orderkey = orders.o_orderkey AND ((region.r_name IN ('EUROPE','ASIA') AND orders.o_orderstatus IN ('O','F')) OR (lineitem.l_shipmode IN ('MAIL','SHIP') AND orders.o_orderpriority IN ('1-URGENT','2-HIGH'))) ast=y5 and y6 and y8 and y7 and (y4 and y3 or y1 and y2)
NOTICE:  policy_eval: atom y1 = const:lineitem.l_shipmode|in|MAIL,SHIP
NOTICE:  policy_eval: atom y2 = const:orders.o_orderpriority|in|1-URGENT,2-HIGH
NOTICE:  policy_eval: atom y3 = const:orders.o_orderstatus|in|F,O
NOTICE:  policy_eval: atom y4 = const:region.r_name|in|ASIA,EUROPE
NOTICE:  policy_eval: atom y5 = join:customer.c_custkey=orders.o_custkey
NOTICE:  policy_eval: atom y6 = join:customer.c_nationkey=nation.n_nationkey
NOTICE:  policy_eval: atom y7 = join:lineitem.l_orderkey=orders.o_orderkey
NOTICE:  policy_eval: atom y8 = join:nation.n_regionkey=region.r_regionkey
NOTICE:  policy_eval: combined_ast target=orders ast=y5 and y6 and y8 and y7 and (y4 and y3 or y1 and y2)
NOTICE:  policy_eval: closure_count=5
NOTICE:  policy_eval: target=orders tokens=IDENT:orders.o_custkey OP:= IDENT:customer.c_custkey AND:and IDENT:customer.c_nationkey OP:= IDENT:nation.n_nationkey AND:and IDENT:nation.n_regionkey OP:= IDENT:region.r_regionkey AND:and IDENT:lineitem.l_orderkey OP:= IDENT:orders.o_orderkey AND:and LPAREN:( LPAREN:( IDENT:region.r_name OP:in LPAREN:( STRING:'EUROPE' COMMA:, STRING:'ASIA' RPAREN:) AND:and IDENT:orders.o_orderstatus OP:in LPAREN:( STRING:'O' COMMA:, STRING:'F' RPAREN:) RPAREN:) OR:or LPAREN:( IDENT:lineitem.l_shipmode OP:in LPAREN:( STRING:'MAIL' COMMA:, STRING:'SHIP' RPAREN:) AND:and IDENT:orders.o_orderpriority OP:in LPAREN:( STRING:'1-URGENT' COMMA:, STRING:'2-HIGH' RPAREN:) RPAREN:) RPAREN:)
NOTICE:  policy_eval: target=orders join_classes=[0, 1, 2, 3]
NOTICE:  policy_eval: policy[1] target=orders expr=orders.o_custkey = customer.c_custkey AND customer.c_nationkey = nation.n_nationkey AND nation.n_regionkey = region.r_regionkey AND lineitem.l_orderkey = orders.o_orderkey AND ((region.r_name IN ('EUROPE','ASIA') AND orders.o_orderstatus IN ('O','F')) OR (lineitem.l_shipmode IN ('MAIL','SHIP') AND orders.o_orderpriority IN ('1-URGENT','2-HIGH'))) ast=y5 and y6 and y8 and y7 and (y4 and y3 or y1 and y2)
NOTICE:  policy_eval: atom y1 = const:lineitem.l_shipmode|in|MAIL,SHIP
NOTICE:  policy_eval: atom y2 = const:orders.o_orderpriority|in|1-URGENT,2-HIGH
NOTICE:  policy_eval: atom y3 = const:orders.o_orderstatus|in|F,O
NOTICE:  policy_eval: atom y4 = const:region.r_name|in|ASIA,EUROPE
NOTICE:  policy_eval: atom y5 = join:customer.c_custkey=orders.o_custkey
NOTICE:  policy_eval: atom y6 = join:customer.c_nationkey=nation.n_nationkey
NOTICE:  policy_eval: atom y7 = join:lineitem.l_orderkey=orders.o_orderkey
NOTICE:  policy_eval: atom y8 = join:nation.n_regionkey=region.r_regionkey
NOTICE:  policy_eval: combined_ast target=orders ast=y5 and y6 and y8 and y7 and (y4 and y3 or y1 and y2)
NOTICE:  policy_eval: closure_count=5

OURS EXECUTION:
ERROR: ERROR:  custom_filter[memctx_violation]: allocation escaped query context (label=artifact_blob rel=<global>)
--- Ours notices ---
NOTICE:  policy_eval: target=orders tokens=IDENT:orders.o_custkey OP:= IDENT:customer.c_custkey AND:and IDENT:customer.c_nationkey OP:= IDENT:nation.n_nationkey AND:and IDENT:nation.n_regionkey OP:= IDENT:region.r_regionkey AND:and IDENT:lineitem.l_orderkey OP:= IDENT:orders.o_orderkey AND:and LPAREN:( LPAREN:( IDENT:region.r_name OP:in LPAREN:( STRING:'EUROPE' COMMA:, STRING:'ASIA' RPAREN:) AND:and IDENT:orders.o_orderstatus OP:in LPAREN:( STRING:'O' COMMA:, STRING:'F' RPAREN:) RPAREN:) OR:or LPAREN:( IDENT:lineitem.l_shipmode OP:in LPAREN:( STRING:'MAIL' COMMA:, STRING:'SHIP' RPAREN:) AND:and IDENT:orders.o_orderpriority OP:in LPAREN:( STRING:'1-URGENT' COMMA:, STRING:'2-HIGH' RPAREN:) RPAREN:) RPAREN:)
NOTICE:  policy_eval: target=orders join_classes=[0, 1, 2, 3]
NOTICE:  policy_eval: policy[1] target=orders expr=orders.o_custkey = customer.c_custkey AND customer.c_nationkey = nation.n_nationkey AND nation.n_regionkey = region.r_regionkey AND lineitem.l_orderkey = orders.o_orderkey AND ((region.r_name IN ('EUROPE','ASIA') AND orders.o_orderstatus IN ('O','F')) OR (lineitem.l_shipmode IN ('MAIL','SHIP') AND orders.o_orderpriority IN ('1-URGENT','2-HIGH'))) ast=y5 and y6 and y8 and y7 and (y4 and y3 or y1 and y2)
NOTICE:  policy_eval: atom y1 = const:lineitem.l_shipmode|in|MAIL,SHIP
NOTICE:  policy_eval: atom y2 = const:orders.o_orderpriority|in|1-URGENT,2-HIGH
NOTICE:  policy_eval: atom y3 = const:orders.o_orderstatus|in|F,O
NOTICE:  policy_eval: atom y4 = const:region.r_name|in|ASIA,EUROPE
NOTICE:  policy_eval: atom y5 = join:customer.c_custkey=orders.o_custkey
NOTICE:  policy_eval: atom y6 = join:customer.c_nationkey=nation.n_nationkey
NOTICE:  policy_eval: atom y7 = join:lineitem.l_orderkey=orders.o_orderkey
NOTICE:  policy_eval: atom y8 = join:nation.n_regionkey=region.r_regionkey
NOTICE:  policy_eval: combined_ast target=orders ast=y5 and y6 and y8 and y7 and (y4 and y3 or y1 and y2)
NOTICE:  policy_eval: closure_count=5
NOTICE:  policy_eval: target=orders tokens=IDENT:orders.o_custkey OP:= IDENT:customer.c_custkey AND:and IDENT:customer.c_nationkey OP:= IDENT:nation.n_nationkey AND:and IDENT:nation.n_regionkey OP:= IDENT:region.r_regionkey AND:and IDENT:lineitem.l_orderkey OP:= IDENT:orders.o_orderkey AND:and LPAREN:( LPAREN:( IDENT:region.r_name OP:in LPAREN:( STRING:'EUROPE' COMMA:, STRING:'ASIA' RPAREN:) AND:and IDENT:orders.o_orderstatus OP:in LPAREN:( STRING:'O' COMMA:, STRING:'F' RPAREN:) RPAREN:) OR:or LPAREN:( IDENT:lineitem.l_shipmode OP:in LPAREN:( STRING:'MAIL' COMMA:, STRING:'SHIP' RPAREN:) AND:and IDENT:orders.o_orderpriority OP:in LPAREN:( STRING:'1-URGENT' COMMA:, STRING:'2-HIGH' RPAREN:) RPAREN:) RPAREN:)
NOTICE:  policy_eval: target=orders join_classes=[0, 1, 2, 3]
NOTICE:  policy_eval: policy[1] target=orders expr=orders.o_custkey = customer.c_custkey AND customer.c_nationkey = nation.n_nationkey AND nation.n_regionkey = region.r_regionkey AND lineitem.l_orderkey = orders.o_orderkey AND ((region.r_name IN ('EUROPE','ASIA') AND orders.o_orderstatus IN ('O','F')) OR (lineitem.l_shipmode IN ('MAIL','SHIP') AND orders.o_orderpriority IN ('1-URGENT','2-HIGH'))) ast=y5 and y6 and y8 and y7 and (y4 and y3 or y1 and y2)
NOTICE:  policy_eval: atom y1 = const:lineitem.l_shipmode|in|MAIL,SHIP
NOTICE:  policy_eval: atom y2 = const:orders.o_orderpriority|in|1-URGENT,2-HIGH
NOTICE:  policy_eval: atom y3 = const:orders.o_orderstatus|in|F,O
NOTICE:  policy_eval: atom y4 = const:region.r_name|in|ASIA,EUROPE
NOTICE:  policy_eval: atom y5 = join:customer.c_custkey=orders.o_custkey
NOTICE:  policy_eval: atom y6 = join:customer.c_nationkey=nation.n_nationkey
NOTICE:  policy_eval: atom y7 = join:lineitem.l_orderkey=orders.o_orderkey
NOTICE:  policy_eval: atom y8 = join:nation.n_regionkey=region.r_regionkey
NOTICE:  policy_eval: combined_ast target=orders ast=y5 and y6 and y8 and y7 and (y4 and y3 or y1 and y2)
NOTICE:  policy_eval: closure_count=5

GROUND TRUTH SOURCE: sql
GT COUNT: 83472
