TEST: A (single-table const AND/OR)
QUERY:
SELECT COUNT(*) FROM customer;

ENABLED POLICIES:
customer : (customer.c_acctbal > 0) AND ((customer.c_mktsegment = 'FURNITURE') OR (customer.c_mktsegment = 'HOUSEHOLD')) AND (customer.c_nationkey < 10)
customer : (customer.c_acctbal < 9000) AND ((customer.c_mktsegment = 'MACHINERY') OR (customer.c_mktsegment = 'HOUSEHOLD'))

EXPLAIN OFF (custom_filter.enabled=off):
Aggregate
  ->  Seq Scan on customer

EXPLAIN ON (custom_filter.enabled=on):
Aggregate
  ->  Custom Scan (custom_filter) on customer
        custom_filter: 
        ->  Seq Scan on customer
--- ON notices ---
NOTICE:  policy_contract: artifact name=dict/customer/c_acctbal bytes=162147
NOTICE:  policy_contract: artifact name=dict/customer/c_mktsegment bytes=65
NOTICE:  policy_contract: artifact name=dict/customer/c_nationkey bytes=140
NOTICE:  policy_contract: artifact name=meta/cols/customer bytes=62
NOTICE:  policy_contract: artifact name=meta/dict_sorted/customer/c_acctbal bytes=1
NOTICE:  policy_contract: artifact name=meta/dict_sorted/customer/c_mktsegment bytes=1
NOTICE:  policy_contract: artifact name=meta/dict_sorted/customer/c_nationkey bytes=1
NOTICE:  policy_contract: artifact name=meta/dict_type/customer/c_acctbal bytes=5
NOTICE:  policy_contract: artifact name=meta/dict_type/customer/c_mktsegment bytes=4
NOTICE:  policy_contract: artifact name=meta/dict_type/customer/c_nationkey bytes=3
NOTICE:  policy_contract: meta/cols/customer=[customer.c_acctbal, customer.c_mktsegment, customer.c_nationkey]
NOTICE:  policy_contract: customer_code_base stride=4 rows=15000
NOTICE:  policy_contract: offset const:customer.c_acctbal = 1 stride=4
NOTICE:  policy_contract: offset const:customer.c_mktsegment = 2 stride=4
NOTICE:  policy_contract: offset const:customer.c_nationkey = 3 stride=4
NOTICE:  policy_contract: atom y1 type=COL_CONST col=customer.c_acctbal op=2 join_class=-1 dict=dict/customer/c_acctbal dict_present=1 eval=range_evaluated vals=[9000] toks=[-1]
NOTICE:  policy_contract: atom y2 type=COL_CONST col=customer.c_acctbal op=4 join_class=-1 dict=dict/customer/c_acctbal dict_present=1 eval=range_evaluated vals=[0] toks=[-1]
NOTICE:  policy_contract: atom y3 type=COL_CONST col=customer.c_mktsegment op=0 join_class=-1 dict=dict/customer/c_mktsegment dict_present=1 eval=exact vals=[FURNITURE] toks=[2]
NOTICE:  policy_contract: atom y4 type=COL_CONST col=customer.c_mktsegment op=0 join_class=-1 dict=dict/customer/c_mktsegment dict_present=1 eval=exact vals=[HOUSEHOLD] toks=[3]
NOTICE:  policy_contract: atom y5 type=COL_CONST col=customer.c_mktsegment op=0 join_class=-1 dict=dict/customer/c_mktsegment dict_present=1 eval=exact vals=[MACHINERY] toks=[4]
NOTICE:  policy_contract: atom y6 type=COL_CONST col=customer.c_nationkey op=2 join_class=-1 dict=dict/customer/c_nationkey dict_present=1 eval=range_evaluated vals=[10] toks=[-1]
NOTICE:  policy_contract: AST(customer)=(customer.c_acctbal < 9000 AND (customer.c_mktsegment = 'MACHINERY' OR customer.c_mktsegment = 'HOUSEHOLD'))
NOTICE:  policy: load_ms=0.831
NOTICE:  policy: bundle_eval target=customer bundle_id=2 uses_atoms=3
NOTICE:  policy: local_bins table=customer atoms=3 bins=24
NOTICE:  policy: local_ms table=customer stamp=0.000 bin=0.000 eval=0.157 fill=0.115
NOTICE:  policy: local_eval table=customer sat_calls=6 cache_hits=18
NOTICE:  policy: allow_customer count = 5467 / 15000
NOTICE:  policy: total_ms=2.405
NOTICE:  policy_profile: bundle=2 target=customer K=0 query= local={customer:atoms=3,bins=24,sat=6,hits=18,ms=0.000/0.000/0.157/0.115,total_ms=0.272} prop={iter=0,ms=0.000,classes=[]} decode={customer:5467/15000,ms=0.000,total_ms=0.000} total_ms=2.405
NOTICE:  custom_filter: bundle target=customer allow_count=1025/15000
NOTICE:  custom_filter: final_allow_customer count=1025/15000
NOTICE:  custom_filter: allow_customer popcount=1025/15000
NOTICE:  custom_filter: ctid_map[0]=(0,1)->0
NOTICE:  custom_filter: ctid_map[1]=(0,2)->1
NOTICE:  custom_filter: ctid_map[2]=(0,3)->2
NOTICE:  custom_filter: ctid_map[3]=(0,4)->3
NOTICE:  custom_filter: ctid_map[4]=(0,5)->4
NOTICE:  custom_filter: ctid_index_ms=0.349 rel=customer
NOTICE:  custom_filter: customer_ctid head [0,1 0,2 0,3 0,4 0,5]
NOTICE:  custom_filter: retain rel=customer allow=1875B ctid=120000B blk_index=4332B
NOTICE:  custom_filter: retain total allow=1875B ctid=120000B blk_index=4332B
NOTICE:  custom_filter: allow_bits pre_exec rel=customer count=1025/15000 ptr=0x581a13c86a08 canary=ok mctx=0x581a13c740c0 qctx=0x581a13c740c0 qs=0x581a13c75318
NOTICE:  custom_filter: scan rel=customer type=SeqScan filter=on
NOTICE:  custom_filter: allow_bits mismatch rel=customer allow=1025 passed=0
NOTICE:  custom_filter exec: rel=customer oid=74194 seen=0 passed=0 misses=0 mode=contract
NOTICE:  custom_filter: row validation time = 0.000 ms
NOTICE:  policy_metrics: eval_ms=0.071 artifact_load_ms=1.017 artifact_parse_ms=1.825 stamp_ms=14.050 bin_ms=0.995 local_sat_ms=0.413 prop_ms=0.000 prop_iters=0 decode_ms=0.000 ctid_map_ms=0.349 filter_ms=0.000 rows_seen=0 rows_passed=0 policy_total_ms=22.777
NOTICE:  policy_profile_query: K=0 query_id= total_ms=22.777 local_ms=15.657 prop_ms=0.000 decode_ms=0.000 sat_calls=18 cache_hits=30 closure_tables=1 filtered_targets=1
NOTICE:  policy: scan_count table=customer count=1

OURS EXECUTION:
COUNT: 1025
--- Ours notices ---
NOTICE:  policy_contract: artifact name=dict/customer/c_acctbal bytes=162147
NOTICE:  policy_contract: artifact name=dict/customer/c_mktsegment bytes=65
NOTICE:  policy_contract: artifact name=dict/customer/c_nationkey bytes=140
NOTICE:  policy_contract: artifact name=meta/cols/customer bytes=62
NOTICE:  policy_contract: artifact name=meta/dict_sorted/customer/c_acctbal bytes=1
NOTICE:  policy_contract: artifact name=meta/dict_sorted/customer/c_mktsegment bytes=1
NOTICE:  policy_contract: artifact name=meta/dict_sorted/customer/c_nationkey bytes=1
NOTICE:  policy_contract: artifact name=meta/dict_type/customer/c_acctbal bytes=5
NOTICE:  policy_contract: artifact name=meta/dict_type/customer/c_mktsegment bytes=4
NOTICE:  policy_contract: artifact name=meta/dict_type/customer/c_nationkey bytes=3
NOTICE:  policy_contract: meta/cols/customer=[customer.c_acctbal, customer.c_mktsegment, customer.c_nationkey]
NOTICE:  policy_contract: customer_code_base stride=4 rows=15000
NOTICE:  policy_contract: offset const:customer.c_acctbal = 1 stride=4
NOTICE:  policy_contract: offset const:customer.c_mktsegment = 2 stride=4
NOTICE:  policy_contract: offset const:customer.c_nationkey = 3 stride=4
NOTICE:  policy_contract: atom y1 type=COL_CONST col=customer.c_acctbal op=2 join_class=-1 dict=dict/customer/c_acctbal dict_present=1 eval=range_evaluated vals=[9000] toks=[-1]
NOTICE:  policy_contract: atom y2 type=COL_CONST col=customer.c_acctbal op=4 join_class=-1 dict=dict/customer/c_acctbal dict_present=1 eval=range_evaluated vals=[0] toks=[-1]
NOTICE:  policy_contract: atom y3 type=COL_CONST col=customer.c_mktsegment op=0 join_class=-1 dict=dict/customer/c_mktsegment dict_present=1 eval=exact vals=[FURNITURE] toks=[2]
NOTICE:  policy_contract: atom y4 type=COL_CONST col=customer.c_mktsegment op=0 join_class=-1 dict=dict/customer/c_mktsegment dict_present=1 eval=exact vals=[HOUSEHOLD] toks=[3]
NOTICE:  policy_contract: atom y5 type=COL_CONST col=customer.c_mktsegment op=0 join_class=-1 dict=dict/customer/c_mktsegment dict_present=1 eval=exact vals=[MACHINERY] toks=[4]
NOTICE:  policy_contract: atom y6 type=COL_CONST col=customer.c_nationkey op=2 join_class=-1 dict=dict/customer/c_nationkey dict_present=1 eval=range_evaluated vals=[10] toks=[-1]
NOTICE:  policy_contract: AST(customer)=(customer.c_acctbal < 9000 AND (customer.c_mktsegment = 'MACHINERY' OR customer.c_mktsegment = 'HOUSEHOLD'))
NOTICE:  policy: load_ms=0.818
NOTICE:  policy: bundle_eval target=customer bundle_id=2 uses_atoms=3
NOTICE:  policy: local_bins table=customer atoms=3 bins=24
NOTICE:  policy: local_ms table=customer stamp=0.000 bin=0.000 eval=0.155 fill=0.112
NOTICE:  policy: local_eval table=customer sat_calls=6 cache_hits=18
NOTICE:  policy: allow_customer count = 5467 / 15000
NOTICE:  policy: total_ms=2.417
NOTICE:  policy_profile: bundle=2 target=customer K=0 query= local={customer:atoms=3,bins=24,sat=6,hits=18,ms=0.000/0.000/0.155/0.112,total_ms=0.267} prop={iter=0,ms=0.000,classes=[]} decode={customer:5467/15000,ms=0.000,total_ms=0.000} total_ms=2.417
NOTICE:  custom_filter: bundle target=customer allow_count=1025/15000
NOTICE:  custom_filter: final_allow_customer count=1025/15000
NOTICE:  custom_filter: allow_customer popcount=1025/15000
NOTICE:  custom_filter: ctid_map[0]=(0,1)->0
NOTICE:  custom_filter: ctid_map[1]=(0,2)->1
NOTICE:  custom_filter: ctid_map[2]=(0,3)->2
NOTICE:  custom_filter: ctid_map[3]=(0,4)->3
NOTICE:  custom_filter: ctid_map[4]=(0,5)->4
NOTICE:  custom_filter: ctid_index_ms=0.346 rel=customer
NOTICE:  custom_filter: customer_ctid head [0,1 0,2 0,3 0,4 0,5]
NOTICE:  custom_filter: retain rel=customer allow=1875B ctid=120000B blk_index=4332B
NOTICE:  custom_filter: retain total allow=1875B ctid=120000B blk_index=4332B
NOTICE:  custom_filter: allow_bits pre_exec rel=customer count=1025/15000 ptr=0x581a13c7e368 canary=ok mctx=0x581a13c6b2e0 qctx=0x581a13c6b2e0 qs=0x581a13c6c538
NOTICE:  custom_filter: scan rel=customer type=SeqScan filter=on
NOTICE:  custom_filter: tid_source rel=customer scan=SeqScan source=tts_tid
NOTICE:  custom_filter exec: rel=customer oid=74194 seen=15000 passed=1025 misses=0 mode=contract
NOTICE:  custom_filter: row validation time = 1.313 ms
NOTICE:  policy_metrics: eval_ms=0.290 artifact_load_ms=1.407 artifact_parse_ms=1.957 stamp_ms=10.265 bin_ms=1.020 local_sat_ms=0.384 prop_ms=0.000 prop_iters=0 decode_ms=0.000 ctid_map_ms=0.346 filter_ms=1.313 rows_seen=15000 rows_passed=1025 policy_total_ms=18.557
NOTICE:  policy_profile_query: K=0 query_id= total_ms=18.557 local_ms=11.865 prop_ms=0.000 decode_ms=0.000 sat_calls=18 cache_hits=30 closure_tables=1 filtered_targets=1
NOTICE:  policy: scan_count table=customer count=1

GROUND TRUTH SOURCE: rls
GT COUNT: 1025
